<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoca Puan - YÃ¶netici Paneli</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; padding: 15px; display: flex; justify-content: center; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 15px; border: 1px solid #333; width: 100%; max-width: 400px; }
        h2 { color: #10b981; text-align: center; margin-top: 0; }
        .input-group { display: flex; flex-direction: column; gap: 10px; }
        input { background: #2d2d2d; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; outline: none; }
        input:focus { border-color: #10b981; }
        button { background: #10b981; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #059669; }
        ul { list-style: none; padding: 0; margin-top: 25px; }
        li { background: #2d2d2d; margin-bottom: 12px; padding: 15px; border-radius: 10px; border-left: 5px solid #10b981; position: relative; }
        .subject { color: #10b981; font-weight: bold; font-size: 0.9em; }
        .text { display: block; margin: 5px 0; font-size: 1.1em; }
        .date { color: #888; font-size: 0.8em; }
        .del-btn { position: absolute; right: 10px; top: 10px; color: #ff4444; background: none; border: none; font-size: 20px; cursor: pointer; display: none; }
        .admin-lock { font-size: 10px; color: #444; text-align: center; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <h2>âš¡ Ã–dev YÃ¶netimi</h2>
    <div class="input-group">
        <input type="text" id="subjectInput" placeholder="Ders (Ã–rn: Fizik)">
        <input type="text" id="taskInput" placeholder="Ã–dev DetayÄ±">
        <input type="date" id="dateInput">
        <button onclick="addTask()">YAYINLA</button>
    </div>

    <ul id="taskList"></ul>
    <div class="admin-lock" onclick="unlockAdmin()">Admin Modu KapalÄ±</div>
</div>

<script>
    const S_URL = "https://xuvrtgvzosobhwpyglsz.supabase.co";
    const S_KEY = "sb_publishable_uyuYnuRcWL4dxgsBp_lA7w_9KBjIt1s";
    let adminMode = false;

    // Supabase'i BaÅŸlat (Garanti YÃ¶ntem)
    const supabaseClient = window.supabase.createClient(S_URL, S_KEY);

    // Verileri Getir
    async function loadTasks() {
        try {
            const { data, error } = await supabaseClient.from('odevler').select('*').order('created_at', { ascending: false });
            if (error) throw error;

            const list = document.getElementById('taskList');
            list.innerHTML = '';
            data.forEach(item => {
                list.innerHTML += `
                    <li>
                        <span class="subject">${item.subject || 'DERS'}</span>
                        <span class="text">${item.odev}</span>
                        <span class="date">ðŸ—“ ${item.deadline || 'SÃ¼resiz'}</span>
                        <button class="del-btn" style="display: ${adminMode ? 'block' : 'none'}" onclick="deleteTask(${item.id})">Ã—</button>
                    </li>`;
            });
        } catch (e) {
            alert("YÃ¼kleme HatasÄ±: " + e.message);
        }
    }

    // Ã–dev Ekle
    async function addTask() {
        const sub = document.getElementById('subjectInput').value;
        const task = document.getElementById('taskInput').value;
        const date = document.getElementById('dateInput').value;

        if(!task) return alert("Ã–dev boÅŸ olamaz!");

        try {
            const { error } = await supabaseClient.from('odevler').insert([
                { subject: sub, odev: task, deadline: date }
            ]);

            if (error) {
                alert("Supabase HatasÄ±: " + error.message);
            } else {
                document.getElementById('subjectInput').value = '';
                document.getElementById('taskInput').value = '';
                loadTasks();
            }
        } catch (e) {
            alert("BaÄŸlantÄ± HatasÄ±: " + e.message);
        }
    }

    // Admin Kilidini AÃ§ (Gizli Ã–zellik)
    function unlockAdmin() {
        let pass = prompt("YÃ¶netici Åžifresi Gir:");
        if(pass === "1234") { // Åžifreyi buradan deÄŸiÅŸtirebilirsin
            adminMode = true;
            document.querySelector('.admin-lock').innerText = "Admin Modu: AKTÄ°F";
            loadTasks();
            alert("YÃ¶netici modu aÃ§Ä±ldÄ±. ArtÄ±k silebilirsin.");
        } else {
            alert("YanlÄ±ÅŸ ÅŸifre!");
        }
    }

    // Silme Ä°ÅŸlemi
    async function deleteTask(id) {
        await supabaseClient.from('odevler').delete().eq('id', id);
        loadTasks();
    }

    loadTasks();
</script>
</body>
</html>

