<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√ºzik Listesi</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 20px; }
        .box { max-width: 400px; margin: auto; background: #1e1e1e; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #444; box-sizing: border-box; }
        button { background: #1DB954; color: black; font-weight: bold; cursor: pointer; border: none; }
        ul { list-style: none; padding: 0; }
        li { background: #282828; padding: 10px; margin-bottom: 10px; border-radius: 5px; position: relative; }
        .del { display: none; color: red; float: right; cursor: pointer; background: none; border: none; font-size: 20px; width: auto; }
    </style>
</head>
<body>

<div class="box">
    <h2 style="color: #1DB954; text-align: center;">üéµ M√ºzik Listesi</h2>
    <input type="text" id="ad" placeholder="≈ûarkƒ± Adƒ±">
    <input type="text" id="sanat" placeholder="Sanat√ßƒ±">
    <input type="text" id="lnk" placeholder="≈ûarkƒ± Linki">
    <input type="text" id="kim" placeholder="Ekleyen Adƒ±">
    <button id="addBtn">Lƒ∞STEYE EKLE</button>
    <ul id="list"></ul>
    <p id="adminTrigger" style="text-align: center; color: #444; cursor: pointer; font-size: 12px; margin-top: 20px;">Y√∂netici Giri≈üi</p>
</div>

<script>
    const S_URL = "https://xuvrtgvzosobhwpyglsz.supabase.co";
    const S_KEY = "sb_publishable_uyuYnuRcWL4dxgsBp_lA7w_9KBjIt1s";
    const supabase = window.supabase.createClient(S_URL, S_KEY);

    // Verileri Y√ºkle
    async function load() {
        const { data, error } = await supabase.from('sarkilar').select('*').order('oy_sayisi', { ascending: false });
        if (error) return console.error(error);
        
        const listDiv = document.getElementById('list');
        listDiv.innerHTML = '';
        data.forEach(item => {
            listDiv.innerHTML += `<li>
                <button class="del" onclick="deleteSong(${item.id})">‚úñ</button>
                <b>${item.sarki_adi}</b><br>
                <small>${item.sanatci} | ${item.ekleyen}</small><br>
                <a href="${item.link}" target="_blank" style="color:#1DB954; text-decoration:none;">‚ñ∂ Dinle</a>
                <div style="float:right;">
                    <span>${item.oy_sayisi}</span>
                    <button onclick="vote(${item.id}, ${item.oy_sayisi})" style="width:auto; padding:5px; margin-left:5px;">üëç</button>
                </div>
            </li>`;
        });
    }

    // Butona Tƒ±klama Olayƒ± (En Garantili Y√∂ntem)
    document.getElementById('addBtn').addEventListener('click', async () => {
        const a = document.getElementById('ad').value;
        const s = document.getElementById('sanat').value;
        const l = document.getElementById('lnk').value;
        const k = document.getElementById('kim').value;

        if(!a || !s) return alert("≈ûarkƒ± ve Sanat√ßƒ± bo≈ü olamaz!");

        const { error } = await supabase.from('sarkilar').insert([
            { sarki_adi: a, sanatci: s, link: l, ekleyen: k, oy_sayisi: 0 }
        ]);

        if(error) {
            alert("HATA: " + error.message);
        } else {
            alert("≈ûarkƒ± Eklendi!");
            location.reload(); // Sayfayƒ± yenileyerek listeyi tazele
        }
    });

    // Y√∂netici Giri≈üi
    document.getElementById('adminTrigger').addEventListener('click', () => {
        const sifre = prompt("Admin ≈ûifresi:");
        if(sifre === "1234") {
            document.querySelectorAll('.del').forEach(d => d.style.display = 'block');
            alert("Y√∂netici moduna girildi!");
        } else {
            alert("Yanlƒ±≈ü ≈üifre!");
        }
    });

    async function vote(id, current) {
        await supabase.from('sarkilar').update({ oy_sayisi: current + 1 }).eq('id', id);
        load();
    }

    async function deleteSong(id) {
        if(confirm("Siliyorum?")) {
            await supabase.from('sarkilar').delete().eq('id', id);
            load();
        }
    }

    load();
</script>
</body>
</html>
