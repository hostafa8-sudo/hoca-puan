<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SÄ±nÄ±f MÃ¼zik Merkezi</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; background: #000; color: #fff; padding: 15px; margin: 0; }
        .main-card { background: #121212; padding: 20px; border-radius: 16px; border: 1px solid #333; max-width: 450px; margin: auto; }
        h2 { color: #1DB954; text-align: center; margin-bottom: 20px; }
        input { width: 100%; background: #222; border: 1px solid #444; color: #fff; padding: 12px; margin-bottom: 10px; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; background: #1DB954; color: #000; border: none; padding: 14px; border-radius: 30px; font-weight: bold; font-size: 16px; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .song-list { margin-top: 25px; }
        .song-card { background: #181818; padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #282828; display: flex; justify-content: space-between; align-items: center; position: relative; }
        .info { flex: 1; }
        .title { font-weight: bold; color: #fff; display: block; margin-bottom: 4px; }
        .sub { color: #b3b3b3; font-size: 13px; }
        .listen-btn { color: #1DB954; text-decoration: none; font-size: 12px; font-weight: bold; margin-top: 8px; display: inline-block; }
        .vote-btn { background: #282828; color: #1DB954; width: auto; padding: 8px 15px; border-radius: 8px; margin-left: 10px; font-size: 14px; border: 1px solid #1DB954; }
        .del-x { position: absolute; right: -5px; top: -5px; background: #ff4444; color: #fff; width: 24px; height: 24px; border-radius: 50%; line-height: 24px; text-align: center; display: none; font-weight: bold; cursor: pointer; }
        #admin-panel { margin-top: 30px; text-align: center; color: #333; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

<div class="main-card">
    <h2>ğŸµ MÃ¼zik Merkezi</h2>
    
    <input type="text" id="sarki_ad" placeholder="ÅarkÄ± AdÄ±">
    <input type="text" id="sanatci" placeholder="SanatÃ§Ä±">
    <input type="text" id="link" placeholder="YouTube/Spotify Linki">
    <input type="text" id="ekleyen" placeholder="AdÄ±n">
    <button onclick="yeniSarkiEkle()">LÄ°STEYE GÃ–NDER</button>

    <div class="song-list" id="liste">
        </div>

    <div id="admin-panel" onclick="merkezKontrol()">Sistem Durumu: Normal</div>
</div>

<script>
    // Supabase BaÄŸlantÄ±sÄ±
    const SUPA_URL = "https://xuvrtgvzosobhwpyglsz.supabase.co";
    const SUPA_KEY = "sb_publishable_uyuYnuRcWL4dxgsBp_lA7w_9KBjIt1s";
    const supabase = window.supabase.createClient(SUPA_URL, SUPA_KEY);

    let merkezModu = false;

    // 1. ÅarkÄ±larÄ± Getir (Load)
    async function verileriGetir() {
        const { data, error } = await supabase.from('sarkilar').select('*').order('oy_sayisi', { ascending: false });
        
        if (error) {
            console.error("YÃ¼kleme hatasÄ±:", error);
            return;
        }

        const listeBox = document.getElementById('liste');
        listeBox.innerHTML = '';

        data.forEach(item => {
            listeBox.innerHTML += `
                <div class="song-card">
                    <div class="info">
                        <span class="title">${item.sarki_adi}</span>
                        <span class="sub">${item.sanatci} â€¢ <small>${item.ekleyen || 'Anonim'}</small></span><br>
                        ${item.link ? `<a href="${item.link}" target="_blank" class="listen-link">â–¶ DÄ°NLE</a>` : ''}
                    </div>
                    <div style="text-align:center">
                        <span style="display:block; font-weight:bold; color:#1DB954; margin-bottom:4px">${item.oy_sayisi}</span>
                        <button class="vote-btn" onclick="puanVer(${item.id}, ${item.oy_sayisi})">ğŸ‘</button>
                    </div>
                    <div class="del-x" style="display:${merkezModu ? 'block' : 'none'}" onclick="sarkiSil(${item.id})">Ã—</div>
                </div>
            `;
        });
    }

    // 2. Yeni ÅarkÄ± Ekle (Insert)
    async function yeniSarkiEkle() {
        const ad = document.getElementById('sarki_ad').value;
        const san = document.getElementById('sanatci').value;
        const lnk = document.getElementById('link').value;
        const kim = document.getElementById('ekleyen').value;

        if (!ad || !san) {
            alert("En azÄ±ndan ÅarkÄ± ve SanatÃ§Ä± kÄ±smÄ±nÄ± doldur!");
            return;
        }

        const { error } = await supabase.from('sarkilar').insert([
            { sarki_adi: ad, sanatci: san, link: lnk, ekleyen: kim, oy_sayisi: 0 }
        ]);

        if (error) {
            alert("Hata oluÅŸtu, tekrar dene: " + error.message);
        } else {
            alert("ÅarkÄ± merkeze eklendi!");
            // AlanlarÄ± temizle
            document.getElementById('sarki_ad').value = '';
            document.getElementById('sanatci').value = '';
            document.getElementById('link').value = '';
            verileriGetir(); // Listeyi yenile
        }
    }

    // 3. Puan Ver (Update)
    async function puanVer(id, suAnki) {
        await supabase.from('sarkilar').update({ oy_sayisi: suAnki + 1 }).eq('id', id);
        verileriGetir();
    }

    // 4. Merkez Kontrol (Admin)
    function merkezKontrol() {
        const sifre = prompt("Merkez Kontrol Åifresi:");
        if (sifre === "1234") {
            merkezModu = true;
            document.getElementById('admin-panel').innerText = "Sistem Durumu: YÃ–NETÄ°CÄ° AKTÄ°F";
            verileriGetir(); // Listeyi yenileyip silme butonlarÄ±nÄ± gÃ¶ster
            alert("Telefon 'Merkez' moduna alÄ±ndÄ±. ArtÄ±k ÅŸarkÄ±larÄ± silebilirsin.");
        } else {
            alert("Yetkisiz GiriÅŸ Denemesi!");
        }
    }

    // 5. ÅarkÄ± Sil (Delete)
    async function sarkiSil(id) {
        if (confirm("Bu ÅŸarkÄ±yÄ± listeden kaldÄ±rmak istediÄŸine emin misin?")) {
            await supabase.from('sarkilar').delete().eq('id', id);
            verileriGetir();
        }
    }

    // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda verileri Ã§ek
    verileriGetir();
</script>

</body>
</html>

