<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sƒ±nƒ±f M√ºzik Listesi</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #121212; color: white; }
        .box { background: #1e1e1e; padding: 20px; border-radius: 10px; max-width: 400px; margin: auto; border: 1px solid #333; }
        input, button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: 1px solid #444; box-sizing: border-box; }
        input { background: #2d2d2d; color: white; }
        button { background: #1DB954; color: black; font-weight: bold; border: none; cursor: pointer; }
        li { background: #282828; margin-top: 10px; padding: 15px; border-radius: 8px; list-style: none; border-left: 5px solid #1DB954; position: relative; }
        .song-name { font-weight: bold; display: block; font-size: 1.1em; }
        .artist-name { color: #b3b3b3; font-size: 0.9em; }
        .link-btn { color: #1DB954; text-decoration: none; font-size: 0.8em; font-weight: bold; margin-top: 5px; display: inline-block; }
        .vote-section { position: absolute; right: 10px; top: 15px; text-align: center; }
        .v-num { display: block; color: #1DB954; font-weight: bold; }
        .del { color: #ff4444; background: none; border: none; cursor: pointer; float: right; font-size: 18px; display: none; }
    </style>
</head>
<body>

<div class="box">
    <h2 style="text-align: center; color: #1DB954;">üéµ Sƒ±nƒ±f Listesi</h2>
    <input type="text" id="s_ad" placeholder="≈ûarkƒ± Adƒ±">
    <input type="text" id="s_sanat" placeholder="Sanat√ßƒ±">
    <input type="text" id="s_link" placeholder="YouTube/Spotify Linki">
    <input type="text" id="s_kim" placeholder="Adƒ±n">
    <button onclick="addTask()">Listeye Ekle</button>
    <div id="list"></div>
    <p onclick="adminModu()" style="font-size: 10px; color: #333; text-align: center; margin-top: 20px; cursor: pointer;">Y√∂netici Giri≈üi</p>
</div>

<script>
    // Senin Supabase Bilgilerin
    const S_URL = "https://xuvrtgvzosobhwpyglsz.supabase.co";
    const S_KEY = "sb_publishable_uyuYnuRcWL4dxgsBp_lA7w_9KBjIt1s";
    const supabase = window.supabase.createClient(S_URL, S_KEY);

    // Listeleme Fonksiyonu (√ñdev sistemindeki loadTasks gibi)
    async function loadTasks() {
        const { data, error } = await supabase.from('sarkilar').select('*').order('oy_sayisi', { ascending: false });
        if (error) { console.log(error); return; }
        
        const listDiv = document.getElementById('list');
        listDiv.innerHTML = '';
        data.forEach(item => {
            listDiv.innerHTML += `<li>
                <button class="del" onclick="deleteTask(${item.id})">‚úñ</button>
                <span class="song-name">${item.sarki_adi}</span>
                <span class="artist-name">${item.sanatci} ‚Ä¢ <small>${item.ekleyen || 'Anonim'}</small></span>
                ${item.link ? `<a href="${item.link}" target="_blank" class="link-btn">‚ñ∂ Dƒ∞NLE</a>` : ''}
                <div class="vote-section">
                    <span class="v-num">${item.oy_sayisi}</span>
                    <button style="width:auto; padding:5px 10px;" onclick="oyVer(${item.id}, ${item.oy_sayisi})">üëç</button>
                </div>
            </li>`;
        });
    }

    // Ekleme Fonksiyonu (√áalƒ±≈üan √∂dev sistemiyle aynƒ± mantƒ±k)
    async function addTask() {
        const ad = document.getElementById('s_ad').value;
        const san = document.getElementById('s_sanat').value;
        const lnk = document.getElementById('s_link').value;
        const kim = document.getElementById('s_kim').value;

        if(!ad) { alert("≈ûarkƒ± adƒ± bo≈ü olamaz!"); return; }

        const { error } = await supabase.from('sarkilar').insert([
            { sarki_adi: ad, sanatci: san, link: lnk, ekleyen: kim, oy_sayisi: 0 }
        ]);

        if (error) {
            alert("Hata: " + error.message);
        } else {
            alert("≈ûarkƒ± eklendi!");
            document.getElementById('s_ad').value = '';
            document.getElementById('s_sanat').value = '';
            document.getElementById('s_link').value = '';
            loadTasks();
        }
    }

    // Oy Verme
    async function oyVer(id, mevcut) {
        await supabase.from('sarkilar').update({ oy_sayisi: mevcut + 1 }).eq('id', id);
        loadTasks();
    }

    // Silme
    async function deleteTask(id) {
        if(confirm("Silinsin mi?")) {
            await supabase.from('sarkilar').delete().eq('id', id);
            loadTasks();
        }
    }

    // Y√∂netici
    function adminModu() {
        if(prompt("≈ûifre:") === "1234") {
            document.querySelectorAll('.del').forEach(b => b.style.display = 'block');
            alert("Y√∂netici modu a√ßƒ±ldƒ±!");
        }
    }

    loadTasks();
</script>
</body>
</html>

